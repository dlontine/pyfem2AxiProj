<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>5.6. Assembly, Part I &mdash; pyfem2 3.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="pyfem2 3.0 documentation" href="../index.html" />
    <link rel="up" title="5. Implementation Details" href="index.html" />
    <link rel="next" title="5.7. Application of Boundary Conditions" href="Boundary2.html" />
    <link rel="prev" title="5.5. Source terms and Distributed Loads" href="DistributedLoads.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="assembly-part-i">
<span id="assembly1"></span><h1>5.6. Assembly, Part I<a class="headerlink" href="#assembly-part-i" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>5.6.1. Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Assembly is the process of merging element equations in to their
corresponding locations in the global equations. The assembler described
constructs and merges one element at a time and adopts the following
assumptions:</p>
<ul class="simple">
<li>internal node numbers are ordered continuously from
<span class="math">\(0\rightarrow n-1\)</span>, where <span class="math">\(n\)</span> is the total number of nodes (though
external node labels can be assigned arbitrarily, see
<a class="reference internal" href="InternalNodesAndElements.html#internalnodesandelements"><span>Nodes and elements</span></a>);</li>
<li>the number and type of degrees of freedom at each node is the same;</li>
<li>there are no multifreedom constraints; and</li>
<li>the global stiffness matrix is stored as a full symmetric matrix.</li>
</ul>
</div>
<div class="section" id="assembly-by-example">
<h2>5.6.2. Assembly by Example<a class="headerlink" href="#assembly-by-example" title="Permalink to this headline">¶</a></h2>
<p>The assembly process is clearly described by example.  Consider the following truss:</p>
<div class="figure align-center" id="id1">
<a class="reference internal image-reference" href="../_images/Truss1.png"><img alt="../_images/Truss1.png" src="../_images/Truss1.png" style="width: 357.0px; height: 363.0px;" /></a>
<p class="caption"><span class="caption-text">Example two element truss.</span></p>
</div>
<p>Each node has two degrees of freedom (translation in the <span class="math">\(x\)</span> and
<span class="math">\(y\)</span> directions), giving <span class="math">\(3\)</span> nodes <span class="math">\(\times\)</span> 2 DOF/node = 6
DOF for the structure. The array of generalized displacements <span class="math">\(\{u\}\)</span> is
organized as</p>
<div class="math">
\[\begin{split}\{u\} = \begin{Bmatrix}
    u_x^0 \\ u_y^0 \\ u_x^1 \\ u_y^1 \\ u_x^2 \\ u_y^2
  \end{Bmatrix} =
  \begin{Bmatrix}
    u_0 \\ u_1 \\ u_2 \\ u_3 \\ u_4 \\ u_5
  \end{Bmatrix}\end{split}\]</div>
<p>The associated global stiffness <span class="math">\([K]\)</span> is a <span class="math">\(6\times6\)</span> matrix that we
initialize with zeros:</p>
<div class="math">
\[\begin{split}\label{ass.K.1}
  \left[K\right] = \begin{bmatrix}
    0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
    0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
    0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
    0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
    0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
    0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0
  \end{bmatrix}\end{split}\]</div>
<p>Element 0 joins nodes 0 and 1. From the definition of the generalized
displacement array, the local-to-global-DOF mapping for nodes 0 and 1 is:</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="37%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Node</th>
<th class="head">Local DOF</th>
<th class="head">Global DOF</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td><span class="math">\(x\)</span></td>
<td>0</td>
</tr>
<tr class="row-odd"><td>0</td>
<td><span class="math">\(y\)</span></td>
<td>1</td>
</tr>
<tr class="row-even"><td>1</td>
<td><span class="math">\(x\)</span></td>
<td>2</td>
</tr>
<tr class="row-odd"><td>1</td>
<td><span class="math">\(y\)</span></td>
<td>3</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The local to global degree of freedom mapping is stored in the &#8220;Element
freedom table&#8221; <code class="docutils literal"><span class="pre">eft</span></code>, where <code class="docutils literal"><span class="pre">eft[i]</span></code> is the global degree of freedom
for local degree of freedom <code class="docutils literal"><span class="pre">i</span></code>. For example, the <code class="docutils literal"><span class="pre">eft</span></code> for the
preceding table is <code class="docutils literal"><span class="pre">eft=[0,1,2,3]</span></code>.</p>
</div>
<p>The element stiffness matrix <span class="math">\(\left[k^0\right]\)</span> is a fully populated
matrix given on the left below with the element freedom table entries marking
the columns and rows. The result of merging the element stiffness
<span class="math">\(\left[k^0\right]\)</span> in to the global stiffness <span class="math">\(\left[K\right]\)</span> is
shown on the right.</p>
<div class="math">
\[\begin{split}\label{ass.k1.1}
  \stackrel{\begin{matrix}
      \hphantom{k_{11}^0} &amp;
      \hphantom{k_{12}^0} &amp;
      \hphantom{k_{13}^0} &amp;
      \hphantom{k_{14}^0} \\ 0 &amp; 1 &amp; 2 &amp; 3 \end{matrix}}{
  \begin{bmatrix}
    k_{11}^0 &amp; k_{12}^0 &amp; k_{13}^0 &amp; k_{14}^0 \\
    k_{21}^0 &amp; k_{22}^0 &amp; k_{23}^0 &amp; k_{24}^0 \\
    k_{31}^0 &amp; k_{32}^0 &amp; k_{33}^0 &amp; k_{34}^0 \\
    k_{41}^0 &amp; k_{42}^0 &amp; k_{43}^0 &amp; k_{44}^0
  \end{bmatrix}}\begin{matrix}0\\1\\2\\3\end{matrix} \longrightarrow
  \stackrel{\begin{matrix}
      \hphantom{k_{11}^0} &amp;
      \hphantom{k_{12}^0} &amp;
      \hphantom{k_{13}^0} &amp;
      \hphantom{k_{14}^0} &amp;
      \hphantom{0} &amp;
      \hphantom{0} \\ 0 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 \end{matrix}}{
  \begin{bmatrix}
    k_{11}^0 &amp; k_{12}^0 &amp; k_{13}^0 &amp; k_{14}^0 &amp; 0 &amp; 0 \\
    k_{21}^0 &amp; k_{22}^0 &amp; k_{23}^0 &amp; k_{24}^0 &amp; 0 &amp; 0\\
    k_{31}^0 &amp; k_{32}^0 &amp; k_{33}^0 &amp; k_{34}^0 &amp; 0 &amp; 0\\
    k_{41}^0 &amp; k_{42}^0 &amp; k_{43}^0 &amp; k_{44}^0 &amp; 0 &amp; 0\\
    0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
    0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0
  \end{bmatrix}}\begin{matrix}0\\1\\2\\3\\4\\5\\ \end{matrix}\end{split}\]</div>
<p>The local-to-global-DOF mapping can be generalized as:</p>
<div class="math">
\[\text{GLOBAL DOF} = \text{NUMBER OF DOF PER NODE}\times\text{NODE
    NUMBER} + \text{LOCAL DOF}\]</div>
<p><span class="math">\(\text{LOCAL DOF}\)</span> is one of the following integers:</p>
<table border="1" class="docutils">
<colgroup>
<col width="61%" />
<col width="39%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">DOF description</th>
<th class="head">LOCAL DOF</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><span class="math">\(x\)</span></td>
<td>0</td>
</tr>
<tr class="row-odd"><td><span class="math">\(y\)</span></td>
<td>1</td>
</tr>
<tr class="row-even"><td><span class="math">\(z\)</span></td>
<td>2</td>
</tr>
<tr class="row-odd"><td><span class="math">\(\theta_x\)</span></td>
<td>3</td>
</tr>
<tr class="row-even"><td><span class="math">\(\theta_y\)</span></td>
<td>4</td>
</tr>
<tr class="row-odd"><td><span class="math">\(\theta_z\)</span></td>
<td>5</td>
</tr>
<tr class="row-even"><td><span class="math">\(T\)</span></td>
<td>6</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This local-to-global-DOF mapping is only applicable for 0 based array
indexing. For 1 based indexing, the mapping must be adjusted.</p>
</div>
<p>The element freedom table for element 1 is <code class="docutils literal"><span class="pre">eft=[0,1,4,5]</span></code> and
<span class="math">\(\left[k^1\right]\)</span> and <span class="math">\(\left[K\right]\)</span> are:</p>
<div class="math">
\[\begin{split}\stackrel{\begin{matrix}
    \hphantom{k_{11}^0} &amp;
    \hphantom{k_{12}^0} &amp;
    \hphantom{k_{13}^0} &amp;
    \hphantom{k_{14}^0} \\ 0 &amp; 1 &amp; 4 &amp; 5 \end{matrix}}{
\begin{bmatrix}
  k_{11}^1 &amp; k_{12}^1 &amp; k_{13}^1 &amp; k_{14}^1 \\
  k_{21}^1 &amp; k_{22}^1 &amp; k_{23}^1 &amp; k_{24}^1 \\
  k_{31}^1 &amp; k_{32}^1 &amp; k_{33}^1 &amp; k_{34}^1 \\
  k_{41}^1 &amp; k_{42}^1 &amp; k_{43}^1 &amp; k_{44}^1
\end{bmatrix}}\begin{matrix}0\\1\\4\\5\end{matrix} \longrightarrow
\stackrel{\begin{matrix}
    \hphantom{k_{11}^0+k_{11}^1} &amp;
    \hphantom{k_{12}^0+k_{11}^1} &amp;
    \hphantom{k_{13}^0} &amp;
    \hphantom{k_{14}^0} &amp;
    \hphantom{k_{11}^1} &amp;
    \hphantom{k_{11}^1} \\ 0 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 \end{matrix}}{
\begin{bmatrix}
  k_{11}^0+k_{11}^1 &amp; k_{12}^0+k_{11}^1 &amp; k_{13}^0 &amp; k_{14}^0 &amp; k_{13}^1 &amp; k_{23}^1 \\
  k_{21}^0+k_{12}^1 &amp; k_{22}^0+k_{22}^1 &amp; k_{23}^0 &amp; k_{24}^0 &amp; k_{14}^1 &amp; k_{24}^1 \\
  k_{31}^0 &amp; k_{32}^0 &amp; k_{33}^0 &amp; k_{34}^0 &amp; 0 &amp; 0\\
  k_{41}^0 &amp; k_{42}^0 &amp; k_{43}^0 &amp; k_{44}^0 &amp; 0 &amp; 0\\
  k_{31}^1 &amp; k_{32}^1 &amp; 0 &amp; 0 &amp; k_{33}^1 &amp; k_{34}^1\\
  k_{41}^1 &amp; k_{42}^1 &amp; 0 &amp; 0 &amp; k_{43}^1 &amp; k_{44}^1\\
\end{bmatrix}}\begin{matrix}0\\1\\2\\3\\4\\5\\ \end{matrix}\end{split}\]</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>When assembling the global finite element stiffness, the
following questions must be answered in the affirmitive:</p>
<ul class="last simple">
<li>Is the value of <span class="math">\(K_{II}\)</span> equal to the sum of all elements
connected to node <span class="math">\(I\)</span>?</li>
<li>Is the value of <span class="math">\(K_{IJ}\)</span>, <span class="math">\(I\ne J\)</span>, equal to the negative
of all elements connecting nodes <span class="math">\(I\)</span> and <span class="math">\(J\)</span>?</li>
<li>Is the stiffness symmetric?</li>
</ul>
</div>
<p>Looking at the global system in , it is clear that each of the three
preceding questions can be answered in the affirmitive.</p>
</div>
<div class="section" id="assembler-computational-implementation">
<h2>5.6.3. Assembler Computational Implementation<a class="headerlink" href="#assembler-computational-implementation" title="Permalink to this headline">¶</a></h2>
<p>Algorithms for assemblers for the global stiffness and global force are presented.</p>
<div class="section" id="global-stiffness">
<h3>5.6.3.1. Global Stiffness<a class="headerlink" href="#global-stiffness" title="Permalink to this headline">¶</a></h3>
<p>The algorithm for assembling the global stiffness is</p>
<ol class="arabic">
<li><p class="first"><strong>TASK</strong>: Assemble the global stiffness <code class="docutils literal"><span class="pre">K</span></code></p>
<ol class="arabic">
<li><p class="first"><strong>INITIALIZE</strong></p>
<ul class="simple">
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">N</span></code> = number of nodes in the mesh</li>
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">m</span></code> = number of degrees of freedom per node</li>
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">K[N*m,N*m]</span></code> = 0</li>
</ul>
</li>
<li><p class="first"><strong>FOR EACH</strong> element <strong>DO</strong></p>
<ul class="simple">
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">Ke</span></code> = element stiffness</li>
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">n</span></code> = number of nodes on element</li>
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">nodes[n]</span></code> = node numbers of the element</li>
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">eft[n*m]</span></code> = 0</li>
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">i</span></code> = 0</li>
</ul>
<p><strong>COMMENT</strong>: Construct the element freedom table</p>
<ol class="arabic">
<li><p class="first"><strong>DO WHILE</strong> <code class="docutils literal"><span class="pre">i</span></code> &lt; <code class="docutils literal"><span class="pre">n</span></code></p>
<ul class="simple">
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">ni</span></code> = <code class="docutils literal"><span class="pre">nodes[i]</span></code></li>
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">j</span></code> = <code class="docutils literal"><span class="pre">0</span></code></li>
</ul>
<ol class="arabic simple">
<li><strong>DO WHILE</strong> <code class="docutils literal"><span class="pre">j</span></code> &lt; <code class="docutils literal"><span class="pre">m</span></code>:<ul>
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">eft[i+j]</span></code> = <code class="docutils literal"><span class="pre">ni*m</span></code> + <code class="docutils literal"><span class="pre">j</span></code></li>
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">j</span></code> = <code class="docutils literal"><span class="pre">j</span></code> + 1</li>
</ul>
</li>
</ol>
<ul class="simple">
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">i</span></code> = <code class="docutils literal"><span class="pre">i</span></code> + 1</li>
</ul>
</li>
</ol>
<p><strong>COMMENT</strong> Map the local degrees of freedom to the global</p>
<ul class="simple">
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">i</span></code> = 0</li>
</ul>
<ol class="arabic">
<li><p class="first"><strong>DO WHILE</strong> <code class="docutils literal"><span class="pre">i</span></code> &lt; <code class="docutils literal"><span class="pre">n*m</span></code></p>
<ul class="simple">
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">I</span></code> = <code class="docutils literal"><span class="pre">eft[i]</span></code></li>
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">j</span></code> = <code class="docutils literal"><span class="pre">i</span></code></li>
</ul>
<ol class="arabic simple">
<li><strong>DO WHILE</strong> <code class="docutils literal"><span class="pre">j</span></code> &lt; <code class="docutils literal"><span class="pre">n*m</span></code><ul>
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">J</span></code> = <code class="docutils literal"><span class="pre">eft[j]</span></code></li>
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">K[I,J]</span></code> = <code class="docutils literal"><span class="pre">K[I,J]</span></code> + <code class="docutils literal"><span class="pre">Ke[i,j]</span></code></li>
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">K[J,</span> <span class="pre">I]</span></code> = <code class="docutils literal"><span class="pre">K[I,</span> <span class="pre">J]</span></code></li>
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">j</span></code> = <code class="docutils literal"><span class="pre">j</span></code> + 1</li>
</ul>
</li>
</ol>
<ul class="simple">
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">i</span></code> = <code class="docutils literal"><span class="pre">i</span></code> + 1</li>
</ul>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>In <code class="docutils literal"><span class="pre">pyfem2</span></code>, assembly of the global stiffness is performed in the method
<code class="docutils literal"><span class="pre">FiniteElementModel.assemble_global_stiffness_udof</span></code> (<code class="docutils literal"><span class="pre">udof</span></code> stands for
&#8220;uniform degree of freedom&#8221;).</p>
<p>The heart of the assembly process is constructing the element freedom table,
represented by the symbol <code class="docutils literal"><span class="pre">eft</span></code>. The element freedom table contains the global
degree of freedom number for the nodes in the element. For elements having
uniform degrees of freedom, this table can be constructed on the fly using, as shown.</p>
<div class="section" id="stiffness-assembler-example">
<h4>Stiffness assembler example<a class="headerlink" href="#stiffness-assembler-example" title="Permalink to this headline">¶</a></h4>
<p>A representative python code that performs stiffness assembly is the function
<code class="docutils literal"><span class="pre">AssemblePlaneTrussStiffness</span></code>, shown below. <code class="docutils literal"><span class="pre">AssemblePlaneTrussStiffness</span></code> is invoked as</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">K</span> <span class="o">=</span> <span class="n">AssemblePlaneTrussStiffness</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">elecon</span><span class="p">,</span> <span class="n">elemat</span><span class="p">,</span> <span class="n">elefab</span><span class="p">)</span>
</pre></div>
</div>
<p>The arguments <code class="docutils literal"><span class="pre">AssemblePlaneTrussStiffness</span></code> to are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">coord</span></code></td>
<td>Nodal coordinates. <code class="docutils literal"><span class="pre">coord[n,i]</span></code> is the ith coordinate of node n.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">elecon</span></code></td>
<td>Element connectivity. <code class="docutils literal"><span class="pre">elecon[e,n]</span></code> is the nth internal node label of element e.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">elemat</span></code></td>
<td>Element material properties. <code class="docutils literal"><span class="pre">elemat[e]</span></code> are the material properties of element e.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">elefab</span></code></td>
<td>Element fabrication properties. <code class="docutils literal"><span class="pre">elefab[e]</span></code> are the element fabrication properties of element e.</td>
</tr>
</tbody>
</table>
<p>The output is:</p>
<table border="1" class="docutils">
<colgroup>
<col width="5%" />
<col width="95%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">K</span></code></td>
<td>Global stiffness matrix stored as a full (N*m, N*m) symmetric matrix, where m is the number of degrees of freedom per node and N the total number of nodes.</td>
</tr>
</tbody>
</table>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">AssemblePlaneTrussStiffness</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">elecon</span><span class="p">,</span> <span class="n">elemat</span><span class="p">,</span> <span class="n">elefab</span><span class="p">):</span>
    <span class="n">coord</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
    <span class="n">elecon</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">(</span><span class="n">elecon</span><span class="p">)</span>

    <span class="c1"># number of nodes and degrees of freedom per node</span>
    <span class="n">m</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">numele</span> <span class="o">=</span> <span class="n">elecon</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># compute the element stiffness and scatter to global array</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">N</span><span class="o">*</span><span class="n">m</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numele</span><span class="p">):</span>

        <span class="n">nodes</span> <span class="o">=</span> <span class="n">elecon</span><span class="p">[</span><span class="n">e</span><span class="p">]</span>  <span class="c1"># element connectivity</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="n">nodes</span><span class="p">]</span>  <span class="c1"># nodal coordinates</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>  <span class="c1"># number of nodes on element</span>

        <span class="c1"># Element stiffness</span>
        <span class="n">Ke</span> <span class="o">=</span> <span class="n">PlaneTrussElementStiffness</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">elemat</span><span class="p">[</span><span class="n">e</span><span class="p">],</span> <span class="n">elefab</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>

        <span class="c1"># Element freedom table</span>
        <span class="n">eft</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">ni</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
                <span class="n">eft</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">ni</span><span class="o">*</span><span class="n">m</span> <span class="o">+</span> <span class="n">j</span>

        <span class="c1"># Merge element stiffness in to global</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">m</span><span class="p">):</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">eft</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="o">*</span><span class="n">m</span><span class="p">):</span>
                <span class="n">J</span> <span class="o">=</span> <span class="n">eft</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">K</span><span class="p">[</span><span class="n">I</span><span class="p">,</span> <span class="n">J</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Ke</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
                <span class="n">K</span><span class="p">[</span><span class="n">J</span><span class="p">,</span> <span class="n">I</span><span class="p">]</span> <span class="o">=</span> <span class="n">K</span><span class="p">[</span><span class="n">I</span><span class="p">,</span> <span class="n">J</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">K</span>
</pre></div>
</div>
<p>The subordinate function <code class="docutils literal"><span class="pre">PlaneTrussElementStiffness</span></code> computes the element stiffness matrix (see <a class="reference internal" href="../ElementLibrary/Link.html#barelements"><span>Elastic bar elements</span></a>):</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">PlaneTrussElementStiffness</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="n">h</span>
    <span class="n">nn</span> <span class="o">=</span> <span class="n">outer</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

    <span class="c1"># Assemble element stiffness</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span>  <span class="n">nn</span> <span class="c1"># upper left and lower right 2x2</span>
    <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">nn</span> <span class="c1"># lower left and upper right 2x2</span>
    <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">E</span> <span class="o">/</span> <span class="n">h</span> <span class="o">*</span> <span class="n">k</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">AssemblePlaneTrussStiffness</span></code> is valid only for plane truss elements.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Clarity of code was chosen over performance in the implementation of
<code class="docutils literal"><span class="pre">AssemblePlaneTrussStiffness</span></code>. The process of creating the element freedom
table and merging element equations in to the global equations can be
optimized greatly.</p>
</div>
</div>
</div>
<div class="section" id="global-force">
<h3>5.6.3.2. Global Force<a class="headerlink" href="#global-force" title="Permalink to this headline">¶</a></h3>
<p>The algorithm for assembling the global force follows closely that of assembling the global stiffness:</p>
<ol class="arabic">
<li><p class="first"><strong>TASK</strong>: Assemble the global force <code class="docutils literal"><span class="pre">F</span></code></p>
<ol class="arabic">
<li><p class="first"><strong>INITIALIZE</strong></p>
<ul class="simple">
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">N</span></code> = number of nodes in the mesh</li>
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">m</span></code> = number of degrees of freedom per node</li>
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">F[N*m]</span></code> = 0</li>
</ul>
</li>
<li><p class="first"><strong>FOR EACH</strong> element <strong>DO</strong></p>
<ul class="simple">
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">Fe</span></code> = element force</li>
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">n</span></code> = number of nodes on element</li>
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">nodes[n]</span></code> = node numbers of the element</li>
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">eft[n*m]</span></code> = 0</li>
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">i</span></code> = 0</li>
</ul>
<p><strong>COMMENT</strong>: Construct the element freedom table</p>
<ol class="arabic">
<li><p class="first"><strong>DO WHILE</strong> <code class="docutils literal"><span class="pre">i</span></code> &lt; <code class="docutils literal"><span class="pre">n</span></code></p>
<ul class="simple">
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">ni</span></code> = <code class="docutils literal"><span class="pre">nodes[i]</span></code></li>
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">j</span></code> = <code class="docutils literal"><span class="pre">0</span></code></li>
</ul>
<ol class="arabic simple">
<li><strong>DO WHILE</strong> <code class="docutils literal"><span class="pre">j</span></code> &lt; <code class="docutils literal"><span class="pre">m</span></code>:<ul>
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">eft[i+j]</span></code> = <code class="docutils literal"><span class="pre">ni*m</span></code> + <code class="docutils literal"><span class="pre">j</span></code></li>
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">j</span></code> = <code class="docutils literal"><span class="pre">j</span></code> + 1</li>
</ul>
</li>
</ol>
<ul class="simple">
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">i</span></code> = <code class="docutils literal"><span class="pre">i</span></code> + 1</li>
</ul>
</li>
</ol>
<p><strong>COMMENT</strong> Map the local degrees of freedom to the global</p>
<ul class="simple">
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">i</span></code> = 0</li>
</ul>
<ol class="arabic simple">
<li><strong>DO WHILE</strong> <code class="docutils literal"><span class="pre">i</span></code> &lt; <code class="docutils literal"><span class="pre">n*m</span></code><ul>
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">I</span></code> = <code class="docutils literal"><span class="pre">eft[i]</span></code></li>
<li><strong>SET</strong> <code class="docutils literal"><span class="pre">F[I]</span></code> = <code class="docutils literal"><span class="pre">F[I]</span></code> + <code class="docutils literal"><span class="pre">Fe[i]</span></code></li>
</ul>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>In <code class="docutils literal"><span class="pre">pyfem2</span></code>, assembly of the global stiffness is performed in the method
<code class="docutils literal"><span class="pre">FiniteElementModel.assemble_global_force_udof</span></code>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">pyfem2</a></h1>





<p>
<iframe src="https://ghbtns.com/github-btn.html?user=tjfulle&repo=pyfem2&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>




<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Introduction/index.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tutorials/index.html">2. <code class="docutils literal"><span class="pre">pyfem2</span></code> Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ModelDefinition/index.html">3. Defining a Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ElementLibrary/index.html">4. Element Library</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">5. Implementation Details</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Overview.html">5.1. Finite element analysis stages</a></li>
<li class="toctree-l2"><a class="reference internal" href="First.html">5.2. A First Finite Element Program</a></li>
<li class="toctree-l2"><a class="reference internal" href="InternalNodesAndElements.html">5.3. Nodes and elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="Boundary1.html">5.4. Boundary conditions and concentrated loads</a></li>
<li class="toctree-l2"><a class="reference internal" href="DistributedLoads.html">5.5. Source terms and Distributed Loads</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">5.6. Assembly, Part I</a></li>
<li class="toctree-l2"><a class="reference internal" href="Boundary2.html">5.7. Application of Boundary Conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="Truss1.html">5.8. TrussModel: A Complete Truss Program</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/index.html">6. <code class="docutils literal"><span class="pre">pyfem2</span></code> Source</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">5. Implementation Details</a><ul>
      <li>Previous: <a href="DistributedLoads.html" title="previous chapter">5.5. Source terms and Distributed Loads</a></li>
      <li>Next: <a href="Boundary2.html" title="next chapter">5.7. Application of Boundary Conditions</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Tim Fuller.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.7</a>
      
      |
      <a href="../_sources/Implementation/Assembly1.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>